{% extends "myapp/teacher/teacher-base.html" %}

{% block content %}
<div class="container">
    <h1>OCR Submissions for Exam: {{ exam.name }}</h1>

    <table class="table">
        <thead>
            <tr>
                <th>Student ID</th>
                <th>Extracted Answer</th>
                <th>Image</th>
            </tr>
        </thead>
        <tbody>
            {% for submission in submissions %}
            <tr>
                <td>{{ submission.student_id }}</td>
                <td>{{ submission.extracted_text }}</td>
                <td>
                    <!-- Image with modal trigger -->
                    <img src="{{ submission.image.url }}" alt="Student Submission" style="cursor: pointer; max-width: 100px; max-height: 100px;" onclick="showModal('{{ submission.image.url }}')">
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

    <!-- Grade Button -->
    {% if submissions %} <!-- Only show the button if there are submissions -->
        <form action="{% url 'view_grades_ocr' exam.id %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-success">Start Grading</button>
        </form>
    {% endif %}

<!-- Image Modal -->
<div id="imageModal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); align-items:center; justify-content:center;">
    <div style="background-color:white; padding:20px; border-radius: 10px; overflow: hidden;">
        <span style="cursor:pointer; float:right; font-size:24px;" onclick="hideModal()">&times;</span>
        <img id="modalImage" src="" style="max-width:300px; max-height:300px; display: block; margin: auto;">
    </div>
</div>

<script>
function showModal(imageUrl) {
    document.getElementById('modalImage').src = imageUrl;
    document.getElementById('imageModal').style.display = 'flex';
}

function hideModal() {
    document.getElementById('imageModal').style.display = 'none';
}

// Close modal when clicking outside of it
window.onclick = function(event) {
    let modal = document.getElementById('imageModal');
    if (event.target == modal) {
        hideModal();
    }
}
</script>

{% endblock %}
